#!/bin/sh
#SBATCH --job-name=diff_pileup_grid
#SBATCH --time=06-12:00:00
#SBATCH --partition=private-dpnc-gpu,shared-gpu
#SBATCH --chdir=/home/users/a/algren/work/diffusion/
#SBATCH --mem=32GB
#SBATCH --output=logs/slurm-%A-%x_%a.out
#SBATCH --cpus-per-task=8
#SBATCH --exclude=
#SBATCH --gres=gpu:1,VramPerGpu:20G
#SBATCH -a 0-9


##### Adding options for grid search ######
modelnum_layers=(4 5 6)
modelupscale_dims=(64 128 256)
wandbmode=(online)

##### Job script ######
export XDG_RUNTIME_DIR=""



srun apptainer exec --nv -B /home/users/a/algren/scratch:/srv/beegfs/scratch/users/a/algren/,/srv/beegfs/scratch/groups/rodem/ /home/users/a/algren/singularity_images/diffusion_pytorch_2.sif\
	python3 run/diffusion.py \
		model.num_layers=${modelnum_layers[`expr ${SLURM_ARRAY_TASK_ID} / 1 % 3`]}\
		model.upscale_dims=${modelupscale_dims[`expr ${SLURM_ARRAY_TASK_ID} / 3 % 3`]}\
		wandb.mode=${wandbmode[`expr ${SLURM_ARRAY_TASK_ID} / 9 % 1`]}\
		
